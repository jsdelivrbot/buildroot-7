From aa68e669e12eba32afa5830b0c30fbd15ea852de Mon Sep 17 00:00:00 2001
From: Markus Niebel <Markus.Niebel@tq-group.com>
Date: Tue, 31 Mar 2015 13:23:50 +0200
Subject: [PATCH] mtd: fsl-qspi: add support for RDFSR

newer Micron NOR need flag status register read (0x70)
---
 drivers/mtd/spi-nor/fsl-quadspi.c | 8 ++++++++
 1 file changed, 8 insertions(+)

diff --git a/drivers/mtd/spi-nor/fsl-quadspi.c b/drivers/mtd/spi-nor/fsl-quadspi.c
index 2336048..90cb092 100644
--- a/drivers/mtd/spi-nor/fsl-quadspi.c
+++ b/drivers/mtd/spi-nor/fsl-quadspi.c
@@ -205,6 +205,7 @@
 #define SEQID_RDCR		9
 #define SEQID_EN4B		10
 #define SEQID_BRWR		11
+#define SEQID_RDFSR		12
 
 #define QUADSPI_MIN_IOMAP SZ_4M
 
@@ -476,6 +477,11 @@ static void fsl_qspi_init_lut(struct fsl_qspi *q)
 	qspi_writel(q, LUT0(CMD, PAD1, SPINOR_OP_BRWR),
 			base + QUADSPI_LUT(lut_base));
 
+	/* Read Flag Status */
+	lut_base = SEQID_RDFSR * 4;
+	writel(LUT0(CMD, PAD1, SPINOR_OP_RDFSR) | LUT1(FSL_READ, PAD1, 0x1),
+			base + QUADSPI_LUT(lut_base));
+
 	fsl_qspi_lock_lut(q);
 }
 
@@ -507,6 +513,8 @@ static int fsl_qspi_get_seqid(struct fsl_qspi *q, u8 cmd)
 		return SEQID_EN4B;
 	case SPINOR_OP_BRWR:
 		return SEQID_BRWR;
+	case SPINOR_OP_RDFSR:
+		return SEQID_RDFSR;
 	default:
 		if (cmd == q->nor[0].erase_opcode)
 			return SEQID_SE;
