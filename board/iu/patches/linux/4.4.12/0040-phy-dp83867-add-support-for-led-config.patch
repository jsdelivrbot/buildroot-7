From e5d458e9c06fe7d72390324338fec81ad13f097f Mon Sep 17 00:00:00 2001
From: Michael Krummsdorf <michael.krummsdorf@tq-group.com>
Date: Mon, 25 Jan 2016 09:21:00 +0100
Subject: [PATCH] phy: dp83867: add support for led config

Signed-off-by: Michael Krummsdorf <michael.krummsdorf@tq-group.com>
---
 Documentation/devicetree/bindings/net/ti,dp83867.txt |  2 ++
 drivers/net/phy/dp83867.c                            | 17 +++++++++++++++++
 2 files changed, 19 insertions(+)

diff --git a/Documentation/devicetree/bindings/net/ti,dp83867.txt b/Documentation/devicetree/bindings/net/ti,dp83867.txt
index 58d935b..96f2854 100644
--- a/Documentation/devicetree/bindings/net/ti,dp83867.txt
+++ b/Documentation/devicetree/bindings/net/ti,dp83867.txt
@@ -8,6 +8,8 @@ Required properties:
 		for applicable values
 	- ti,fifo-depth - Transmitt FIFO depth- see dt-bindings/net/ti-dp83867.h
 		for applicable values
+	- led-cfg1 - Value of LED configuration register 1
+	- led-cfg2 - Value of LED configuration register 2
 
 Default child nodes are standard Ethernet PHY device
 nodes as described in Documentation/devicetree/bindings/net/phy.txt
diff --git a/drivers/net/phy/dp83867.c b/drivers/net/phy/dp83867.c
index 32f1066..7efa0c1 100644
--- a/drivers/net/phy/dp83867.c
+++ b/drivers/net/phy/dp83867.c
@@ -33,6 +33,8 @@
 /* Extended Registers */
 #define DP83867_RGMIICTL	0x0032
 #define DP83867_RGMIIDCTL	0x0086
+#define DP83867_LEDCR1		0x18
+#define DP83867_LEDCR2		0x19
 
 #define DP83867_SW_RESET	BIT(15)
 #define DP83867_SW_RESTART	BIT(14)
@@ -65,6 +67,8 @@ struct dp83867_private {
 	int rx_id_delay;
 	int tx_id_delay;
 	int fifo_depth;
+	int led_cfg1;
+	int led_cfg2;
 };
 
 static int dp83867_ack_interrupt(struct phy_device *phydev)
@@ -123,6 +127,16 @@ static int dp83867_of_init(struct phy_device *phydev)
 	if (ret)
 		return ret;
 
+	ret = of_property_read_u32(of_node, "led-cfg1",
+				&dp83867->led_cfg1);
+	if (ret)
+		return ret;
+
+	ret = of_property_read_u32(of_node, "led-cfg2",
+				&dp83867->led_cfg2);
+	if (ret)
+		return ret;
+
 	return of_property_read_u32(of_node, "ti,fifo-depth",
 				   &dp83867->fifo_depth);
 }
@@ -180,6 +194,9 @@ static int dp83867_config_init(struct phy_device *phydev)
 		delay = (dp83867->rx_id_delay |
 			(dp83867->tx_id_delay << DP83867_RGMII_TX_CLK_DELAY_SHIFT));
 
+		phy_write(phydev, DP83867_LEDCR1, dp83867->led_cfg1);
+		phy_write(phydev, DP83867_LEDCR2, dp83867->led_cfg2);
+
 		phy_write_mmd_indirect(phydev, DP83867_RGMIIDCTL,
 				       DP83867_DEVADDR, phydev->addr, delay);
 	}
